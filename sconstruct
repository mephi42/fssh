env = Environment()
env.Append(CFLAGS=['-std=c99', '-Wall', '-Werror', '-g2', '-O3'])
env.Append(LIBS=['zmq'])

vars = Variables()
vars.Add(BoolVariable('ENABLE_LTTNG_UST', None, True))
vars.Update(env)

if env['ENABLE_LTTNG_UST']:
	env.Append(CPPDEFINES=['ENABLE_LTTNG_UST'])
	env.Append(LIBS=['lttng-ust'])

client = env.StaticObject('client.o', 'client.c')
daemon = env.StaticObject('daemon.o', 'daemon.c')
fwd = env.StaticObject('fwd.o', 'fwd.c')
main = env.StaticObject('main.o', 'main.c')
message = env.StaticObject('message.o', 'message.c')
reset = env.StaticObject('reset.o', 'reset.c')
nonblock = env.StaticObject('nonblock.o', 'nonblock.c')
ringbuf = env.StaticObject('ringbuf.o', 'ringbuf.c')
un = env.StaticObject('un.o', 'un.c')

fssh = env.Program('fssh', [main, reset])
fssh_client = env.Program('fssh-client', [client, message, nonblock, reset])
fssh_fwd = env.Program('fssh-fwd', [fwd])
fssh_daemon = env.Program('fssh-daemon', [daemon, message, nonblock, reset])
